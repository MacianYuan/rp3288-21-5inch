#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>


#include "GC2155_CIF_priv.h"

//==================================
//sensor setting
//==================================
#define SENSOR_I2C_ADDR					0x78U

#define REG_STREAM_ON					0x0100
#define REG_SOFTWARE_RST				0xFE
#define REG_SOFTWARE_RST_DATA			0x80
#define I2C_NR_ADR_BYTES                1
#define I2C_NR_DAT_BYTES                0x01

#define REG_CHIP_ID_H					0xF0
#define REG_CHIP_ID_L					0xF1

//=================================
#define SENSOR_I2C_NUM					3
#define SENSOR_I2C_RATE					100000
struct rk_sensor_reg {
	unsigned char reg;
	unsigned char val;
};

struct rk_sensor_reg gc2155_sensor_test[] = {
{0xfe , 0xf0},
{0xfe , 0xf0},
{0xfe , 0xf0},
{0xfc , 0x06},
{0xf6 , 0x00},
{0xf7 , 0x1d},
{0xf8 , 0x84},
{0xfa , 0x00},
{0xf9 , 0xfe},
{0xf2 , 0x00},
{0xfe , 0x00},
{0x03 , 0x08},//04
{0x04 , 0x48},//24
{0x09 , 0x00},
{0x0a , 0x00},
{0x0b , 0x00},
{0x0c , 0x00},
{0x0d , 0x04},
{0x0e , 0xc0},
{0x0f , 0x06},
{0x10 , 0x50},
{0x12 , 0x2e},
{0x17 , 0x14}, // mirror
{0x18 , 0x02},
{0x19 , 0x0e},
{0x1a , 0x01},
{0x1b , 0x4b},
{0x1c , 0x07},
{0x1d , 0x10},
{0x1e , 0x98},
{0x1f , 0x78},
{0x20 , 0x05},
{0x21 , 0x40},
{0x22 , 0xf0},
{0x24 , 0x16},
{0x25 , 0x01},
{0x26 , 0x10},
{0x2d , 0x40},
{0x30 , 0x01},
{0x31 , 0x90},
{0x33 , 0x04},
{0x34 , 0x01},
{0xfe , 0x00},
{0x80 , 0xff},
{0x81 , 0x2c},
{0x82 , 0xfa},
{0x83 , 0x00},
{0x84 , 0x00}, //yuv 01
{0x85 , 0x08},
{0x86 , 0x03},
{0x89 , 0x03},
{0x8a , 0x00},
{0x8b , 0x00},
{0xb0 , 0x55},
{0xc3 , 0x11}, //00
{0xc4 , 0x20},
{0xc5 , 0x30},
{0xc6 , 0x38},
{0xc7 , 0x40},
{0xec , 0x02},
{0xed , 0x04},
{0xee , 0x60},
{0xef , 0x90},
{0xb6 , 0x01},
{0x90 , 0x01},
{0x91 , 0x00},
{0x92 , 0x00},
{0x93 , 0x00},
{0x94 , 0x00},
{0x95 , 0x04},
{0x96 , 0xb0},
{0x97 , 0x06},
{0x98 , 0x40},
{0xfe , 0x00},
{0x18 , 0x02},
{0x40 , 0x42},
{0x41 , 0x00},
{0x43 , 0x54},
{0x5e , 0x00},
{0x5f , 0x00},
{0x60 , 0x00},
{0x61 , 0x00},
{0x62 , 0x00},
{0x63 , 0x00},
{0x64 , 0x00},
{0x65 , 0x00},
{0x66 , 0x20},
{0x67 , 0x20},
{0x68 , 0x20},
{0x69 , 0x20},
{0x6a , 0x08},
{0x6b , 0x08},
{0x6c , 0x08},
{0x6d , 0x08},
{0x6e , 0x08},
{0x6f , 0x08},
{0x70 , 0x08},
{0x71 , 0x08},
{0x72 , 0xf0},
{0x7e , 0x3c},
{0x7f , 0x00},
{0xfe , 0x00},
{0xad , 0x80},// r ratio
{0xae , 0x7d},// g ratio
{0xaf , 0x80},// b ratio
{0xfe , 0x01},
{0x01 , 0x08},
{0x02 , 0xc0},
{0x03 , 0x04},
{0x04 , 0x90},
{0x05 , 0x30},
{0x06 , 0x98},
{0x07 , 0x28},
{0x08 , 0x6c},
{0x09 , 0x00},
{0x0a , 0xc2},
{0x0b , 0x11},
{0x0c , 0x36},//10 cyrille
{0x13 , 0x2d},
{0x17 , 0x00},
{0x18 , 0x97},// cyrille
{0x19 , 0x97},// cyrille
{0x1c , 0x11},
{0x1e , 0x61},
{0x1f , 0x30},
{0x20 , 0x40},
{0x22 , 0x80},
{0x23 , 0x20},
{0x12 , 0x35},
{0x15 , 0x50},
{0x10 , 0x31},
{0x3e , 0x28},
{0x3f , 0xe0},
{0x40 , 0xe0},
{0x41 , 0x08},
{0xfe , 0x02},
{0x0f , 0x05},
{0xfe , 0x02},
{0x90 , 0x6c},
{0x91 , 0x03},
{0x92 , 0xc4},
{0x97 , 0x64},
{0x98 , 0x88},
{0x9d , 0x0c},//08
{0xa2 , 0x11},
{0xfe , 0x00},
{0xfe , 0x02},
{0x80 , 0xc1},
{0x81 , 0x08},
{0x82 , 0x0c},//05
{0x83 , 0x09},//04
{0x84 , 0x0a},
{0x86 , 0x80},
{0x87 , 0x30},
{0x88 , 0x15},
{0x89 , 0x80},
{0x8a , 0x60},
{0x8b , 0x30},
{0xfe , 0x01},
{0x21 , 0x14},
{0xfe , 0x02},
{0x3c , 0x06},
{0x3d , 0x40},
{0x48 , 0x30},
{0x49 , 0x06},
{0x4b , 0x08},
{0x4c , 0x20},
{0xa3 , 0x50},
{0xa4 , 0x30},
{0xa5 , 0x40},
{0xa6 , 0x80},
{0xab , 0x40},
{0xae , 0x0c},
{0xb3 , 0x42},
{0xb4 , 0x24},
{0xb6 , 0x50},
{0xb7 , 0x01},
{0xb9 , 0x28}, 
{0xfe , 0x00},	 
{0xfe , 0x02},
{0x10 , 0x0a},
{0x11 , 0x0e},
{0x12 , 0x13},
{0x13 , 0x18},
{0x14 , 0x23},
{0x15 , 0x2f},
{0x16 , 0x3b},
{0x17 , 0x47},
{0x18 , 0x5f},
{0x19 , 0x75},
{0x1a , 0x87},
{0x1b , 0x97},
{0x1c , 0xa4},
{0x1d , 0xb8},
{0x1e , 0xc7},
{0x1f , 0xd4},
{0x20 , 0xde},
{0x21 , 0xe5},
{0x22 , 0xea},
{0x23 , 0xf1},
{0x24 , 0xf7},
{0x25 , 0xfc},	
{0xfe , 0x02},
{0x26 , 0x0d},
{0x27 , 0x12},
{0x28 , 0x17},
{0x29 , 0x1c},
{0x2a , 0x27},
{0x2b , 0x34},
{0x2c , 0x44},
{0x2d , 0x55},
{0x2e , 0x6e},
{0x2f , 0x81},
{0x30 , 0x91},
{0x31 , 0x9c},
{0x32 , 0xaa},
{0x33 , 0xbb},
{0x34 , 0xca},
{0x35 , 0xd5},
{0x36 , 0xe0},
{0x37 , 0xe7},
{0x38 , 0xed},
{0x39 , 0xf6},
{0x3a , 0xfb},
{0x3b , 0xff},
{0xfe , 0x02},
{0xd1 , 0x28},//28
{0xd2 , 0x28},//28
{0xd3 , 0x40},//40
{0xd5 , 0xfa},	//00	
{0xdd , 0x14},//88
{0xde , 0x84},
{0xed , 0x80},
{0xfe , 0x01},
{0xc2 , 0x09},
{0xc3 , 0x12},
{0xc4 , 0x0f},
{0xc8 , 0x19},
{0xc9 , 0x10},
{0xca , 0x00},
{0xbc , 0x2b},
{0xbd , 0x19},
{0xbe , 0x08},
{0xb6 , 0x28},
{0xb7 , 0x42},
{0xb8 , 0x3a},
{0xc5 , 0x31},
{0xc6 , 0x09},
{0xc7 , 0x00},
{0xcb , 0x2a},
{0xcc , 0x01},
{0xcd , 0x15},
{0xbf , 0x00},
{0xc0 , 0x00},
{0xc1 , 0x0e},
{0xb9 , 0x24},
{0xba , 0x13},
{0xbb , 0x13},
{0xaa , 0x02},
{0xab , 0x07},
{0xac , 0x00},
{0xad , 0x12},
{0xae , 0x0d},
{0xaf , 0x1e},
{0xb0 , 0x23},
{0xb1 , 0x13},
{0xb2 , 0x00},
{0xb3 , 0x00},
{0xb4 , 0x0a},
{0xb5 , 0x00},
{0xd0 , 0x31},
{0xd1 , 0x07},
{0xd2 , 0x00},
{0xd6 , 0x0a},
{0xd7 , 0x00},
{0xd8 , 0x00},
{0xd9 , 0x00},
{0xda , 0x00},
{0xdb , 0x46},
{0xd3 , 0x22},
{0xd4 , 0x2c},
{0xd5 , 0x00},
{0xa4 , 0x00},
{0xa5 , 0x00},
{0xa6 , 0x00},
{0xa7 , 0x04},
{0xa8 , 0x32},
{0xa9 , 0x00},
{0xa1 , 0x80},
{0xa2 , 0x80},
{0xfe , 0x01},
{0xdc , 0x35},
{0xdd , 0x28},
{0xdf , 0x0d},
{0xe0 , 0x88},//70
{0xe1 , 0x70},//78
{0xe2 , 0x88},//70
{0xe3 , 0x70},//78
{0xe6 , 0x90},
{0xe7 , 0x70},
{0xe8 , 0x90},
{0xe9 , 0x70},
{0xfe , 0x00},
{0xfe , 0x01},
{0x4f , 0x00},
{0x4f , 0x00},
{0x4b , 0x01},
{0x4f , 0x00},
{0x4c , 0x01},
{0x4d , 0x71},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x91},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x50},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x70},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x90},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0xb0},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0xd0},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x4f},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x6f},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x8f},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0xaf},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0xcf},
{0x4e , 0x02},
{0x4c , 0x01},
{0x4d , 0x6e},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x8e},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xae},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xce},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x4d},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x6d},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x8d},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xad},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xcd},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x4c},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x6c},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x8c},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xac},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xcc},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xec},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x4b},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x6b},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x8b},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0xab},
{0x4e , 0x03},
{0x4c , 0x01},
{0x4d , 0x8a},
{0x4e , 0x04},
{0x4c , 0x01},
{0x4d , 0xaa},
{0x4e , 0x04},
{0x4c , 0x01},
{0x4d , 0xca},
{0x4e , 0x04},
{0x4c , 0x01},
{0x4d , 0xa9},
{0x4e , 0x04},
{0x4c , 0x01},
{0x4d , 0xc9},
{0x4e , 0x04},
{0x4c , 0x01},
{0x4d , 0xcb},
{0x4e , 0x05},
{0x4c , 0x01},
{0x4d , 0xeb},
{0x4e , 0x05},
{0x4c , 0x02},
{0x4d , 0x0b},
{0x4e , 0x05},
{0x4c , 0x02},
{0x4d , 0x2b},
{0x4e , 0x05},
{0x4c , 0x02},
{0x4d , 0x4b},
{0x4e , 0x05},
{0x4c , 0x01},
{0x4d , 0xea},
{0x4e , 0x05},
{0x4c , 0x02},
{0x4d , 0x0a},
{0x4e , 0x05},
{0x4c , 0x02},
{0x4d , 0x2a},
{0x4e , 0x05},
{0x4c , 0x02},
{0x4d , 0x6a},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0x29},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0x49},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0x69},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0x89},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0xa9},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0xc9},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0x48},
{0x4e , 0x06},
{0x4c , 0x02},
{0x4d , 0x68},
{0x4e , 0x06},
{0x4c , 0x03},
{0x4d , 0x09},
{0x4e , 0x07},
{0x4c , 0x02},
{0x4d , 0xa8},
{0x4e , 0x07},
{0x4c , 0x02},
{0x4d , 0xc8},
{0x4e , 0x07},
{0x4c , 0x02},
{0x4d , 0xe8},
{0x4e , 0x07},
{0x4c , 0x03},
{0x4d , 0x08},
{0x4e , 0x07},
{0x4c , 0x03},
{0x4d , 0x28},
{0x4e , 0x07},
{0x4c , 0x02},
{0x4d , 0x87},
{0x4e , 0x07},
{0x4c , 0x02},
{0x4d , 0xa7},
{0x4e , 0x07},
{0x4c , 0x02},
{0x4d , 0xc7},
{0x4e , 0x07},
{0x4c , 0x02},
{0x4d , 0xe7},
{0x4e , 0x07},
{0x4c , 0x03},
{0x4d , 0x07},
{0x4e , 0x07},
{0x4f , 0x01},
{0xfe , 0x01},
{0x50 , 0x80},
{0x51 , 0xa8},
{0x52 , 0x57},
{0x53 , 0x38},
{0x54 , 0xc7},
{0x56 , 0x0e},
{0x58 , 0x08},
{0x5b , 0x00},
{0x5c , 0x74},
{0x5d , 0x8b},
{0x61 , 0xd3},
{0x62 , 0x90},
{0x63 , 0xaa},
{0x65 , 0x04},
{0x67 , 0xb2},
{0x68 , 0xac},
{0x69 , 0x00},
{0x6a , 0xb2},
{0x6b , 0xac},
{0x6c , 0xdc},
{0x6d , 0xb0},
{0x6e , 0x30},
{0x6f , 0x40},
{0x70 , 0x05},
{0x71 , 0x80},
{0x72 , 0x80},
{0x73 , 0x30},
{0x74 , 0x01},
{0x75 , 0x01},
{0x7f , 0x08},
{0x76 , 0x70},
{0x77 , 0x48},
{0x78 , 0xa0},
{0xfe , 0x00},
{0xfe , 0x02},
{0xc0 , 0x01},
{0xc1 , 0x4d},//4a cyrille
{0xc2 , 0xf3},//f3 cyrille
{0xc3 , 0xfd},// fc cyrille
{0xc4 , 0xe4},
{0xc5 , 0x43},//48 cyrille
{0xc6 , 0xec},
{0xc7 , 0x45},
{0xc8 , 0xf8},
{0xc9 , 0x02},
{0xca , 0xfe},
{0xcb , 0x42},
{0xcc , 0x00},
{0xcd , 0x45},
{0xce , 0xf0},
{0xcf , 0x00},
{0xe3 , 0xf0},
{0xe4 , 0x45},
{0xe5 , 0xe8}, 
{0xfe , 0x01},
{0x9f , 0x42},
{0xfe , 0x00}, 
{0xfe , 0x00},
{0x05 , 0x01},
{0x06 , 0x56},
{0x07 , 0x00},
{0x08 , 0x32},
{0xfe , 0x01},
{0x25 , 0x00},
{0x26 , 0xfa}, 
{0x27 , 0x04}, 
{0x28 , 0xe2}, //20fps 
{0x29 , 0x06}, 
{0x2a , 0xd6}, //16fps 
{0x2b , 0x07}, 
{0x2c , 0xd0}, //12fps
{0x2d , 0x0b}, 
{0x2e , 0xb8}, //8fps
{0xfe , 0x00},
{0xfe , 0x00},	///////GC2155_Sensor_SVGA////
{0xfa , 0x00},
{0xfd , 0x01}, 	  
{0xfe , 0x00},
{0x90 , 0x01}, 
{0x91 , 0x00},
{0x92 , 0x00},
{0x93 , 0x00},
{0x94 , 0x00},
{0x95 , 0x02},
{0x96 , 0x58},
{0x97 , 0x03},
{0x98 , 0x20},
{0x99 , 0x11},
{0x9a , 0x06},			  
{0xfe , 0x00},
{0xec , 0x01}, 
{0xed , 0x02},
{0xee , 0x30},
{0xef , 0x48},
{0xfe , 0x01},
{0x74 , 0x00}, 				  
{0xfe , 0x01},
{0x01 , 0x04},
{0x02 , 0x60},
{0x03 , 0x02},
{0x04 , 0x48},
{0x05 , 0x18},
{0x06 , 0x4c},
{0x07 , 0x14},
{0x08 , 0x36},
{0x0a , 0xc0}, 
{0x21 , 0x14}, 
{0xfe , 0x00},
{0xfe , 0x00},
{0xc3 , 0x11},
{0xc4 , 0x20},
{0xc5 , 0x30},
{0xfe , 0x00},
{0xfe , 0x00},
{0xf2 , 0x0f},	
{0xfe , 0x00},
{0xb6 , 0x01},
{0xfa , 0x00},
{0xfd , 0x01},
{0x09 , 0x00},
{0x0a , 0x00},
{0x0b , 0x00},
{0x0c , 0x00},
{0x0d , 0x04},
{0x0e , 0xc0},
{0x0f , 0x06},
{0x10 , 0x50},
{0xfe , 0x00},
{0x90 , 0x01},
{0x91 , 0x00},
{0x92 , 0x00},
{0x93 , 0x00},
{0x94 , 0x00},
{0x95 , 0x02},
{0x96 , 0x58},
{0x97 , 0x03},
{0x98 , 0x20},
{0x99 , 0x11},
{0x9a , 0x06},
{0x9b , 0x00},
{0x9c , 0x00},
{0x9d , 0x00},
{0x9e , 0x00},
{0x9f , 0x00},
{0xa0 , 0x00},
{0xa1 , 0x00},
{0xa2  ,0x00},
{0xfe , 0x00},
{0xec , 0x01},
{0xed , 0x02},
{0xee , 0x30},
{0xef , 0x48},
{0xfe , 0x01},
{0x74 , 0x00},
{0xfe , 0x01},
{0x01 , 0x04},
{0x02 , 0x60},
{0x03 , 0x02},
{0x04 , 0x48},
{0x05 , 0x18},
{0x06 , 0x4c},
{0x07 , 0x14},
{0x08 , 0x36},
{0x0a , 0xc0},
{0x21 , 0x14},
{0xfe , 0x00},
{0xfe , 0x00},
{0xc3 , 0x11},
{0xc4 , 0x20},
{0xc5 , 0x30},
{0xfe , 0x00},
{0xfe , 0x00},
{0x05 , 0x01},
{0x06 , 0x56},
{0x07 , 0x00},
{0x08 , 0x32},
{0xfe , 0x01},
{0x25 , 0x00},
{0x26 , 0xfa},
{0x27 , 0x04},
{0x28 , 0xe2},
{0x29 , 0x06},
{0x2a , 0xd6},
{0x2b , 0x07},
{0x2c , 0xd0},
{0x2d , 0x0b},
{0x2e , 0xb8},
{0xfe , 0x00},


{0x0000 ,0x00}

};


int Gc2155_sensor_reg_init(int camsys_fd,unsigned int *i2cbase)
{
    int err,i2cbytes,i;
    struct rk_sensor_reg *sensor_reg;
    unsigned char *i2cchar;
    camsys_sysctrl_t sysctl;    
    camsys_i2c_info_t i2cinfo;
    int id;
    int size;

    i2cinfo.bus_num = SENSOR_I2C_NUM;
    i2cinfo.slave_addr = SENSOR_I2C_ADDR;
    i2cinfo.reg_addr = REG_SOFTWARE_RST;
    i2cinfo.reg_size = I2C_NR_ADR_BYTES; 
    i2cinfo.val = REG_SOFTWARE_RST_DATA;
    i2cinfo.val_size = I2C_NR_DAT_BYTES;
    i2cinfo.i2cbuf_directly = 0;
    i2cinfo.speed = SENSOR_I2C_RATE;
       
    err = ioctl(camsys_fd, CAMSYS_I2CWR, &i2cinfo);
    if (err<0) {
        printf("CAMSYS_I2CWR failed\n");
    } else {
        printf("I2c write: 0x%x : 0x%x\n",i2cinfo.reg_addr,i2cinfo.val);
    }
	printf("%s %d  hcc\n",__FUNCTION__,__LINE__);  

    usleep(20000);    
    
    i2cinfo.reg_addr = REG_CHIP_ID_H;
    i2cinfo.val_size = 0x01;       
    err = ioctl(camsys_fd, CAMSYS_I2CRD, &i2cinfo);
    if (err<0) {
        printf("CAMSYS_I2CRD failed\n");
    } else {
        printf("I2c read: 0x%x : 0x%x\n",i2cinfo.reg_addr,i2cinfo.val);
        id = (i2cinfo.val<<8);
    }
	 
    i2cinfo.reg_addr = REG_CHIP_ID_L;
    err = ioctl(camsys_fd, CAMSYS_I2CRD, &i2cinfo);
    if (err<0) {
        printf("CAMSYS_I2CRD failed\n");
    } else {
        printf("I2c read: 0x%x : 0x%x\n",i2cinfo.reg_addr,i2cinfo.val);
        id |= i2cinfo.val;
    }

    printf("\n!!!!!!!!!!Sensor ID: 0x%x!!!!!!!!!!\n",id);
    
    i2cchar = (unsigned char*)i2cbase;

	sensor_reg = gc2155_sensor_test;
	size = sizeof(gc2155_sensor_test)/sizeof(struct rk_sensor_reg);

    i2cbytes = 0x00;
    for (i=0; i<size; i++) {
        //*i2cchar++ = (sensor_reg->reg&0xff00)>>8; 
        *i2cchar++ = (sensor_reg->reg&0xff);
        *i2cchar++ = (sensor_reg->val&0xff);
        sensor_reg++;
        i2cbytes += 2;
    }
    printf("i2cbytes(%d)\n",i2cbytes);
    
    i2cinfo.bus_num = SENSOR_I2C_NUM;
    i2cinfo.slave_addr = SENSOR_I2C_ADDR;
    i2cinfo.i2cbuf_directly = 1;
    i2cinfo.i2cbuf_bytes = ((2<<16)|i2cbytes);
    i2cinfo.speed = SENSOR_I2C_RATE;
    err = ioctl(camsys_fd, CAMSYS_I2CWR, &i2cinfo);
    if (err<0) {
        printf("CAMSYS_I2CWR buf failed\n"); 
    }
    return err;
}
int Gc2155_sensor_streamon(int camsys_fd,unsigned int on)
{
    int err,i2cbytes,i;
    struct rk_sensor_reg *sensor_reg;
    camsys_sysctrl_t sysctl;    
    camsys_i2c_info_t i2cinfo;
    int id;

    i2cinfo.bus_num = SENSOR_I2C_NUM;
    i2cinfo.slave_addr = SENSOR_I2C_ADDR;
    i2cinfo.reg_addr = REG_STREAM_ON;
    i2cinfo.reg_size = 2;
    i2cinfo.val = on;
    i2cinfo.val_size = I2C_NR_DAT_BYTES;
    i2cinfo.i2cbuf_directly = 0;
    i2cinfo.speed = SENSOR_I2C_RATE;
       
    err = ioctl(camsys_fd, CAMSYS_I2CWR, &i2cinfo);
    if (err < 0) {
        printf("extdev_streamon failed!\n");
    }
    printf("Sensor stream on : %d\n",on);
    
    return err;
}

int Gc2155_get_SensorInfo(rk_camera_info_t *rk_camera_info)
{
	//rk_camera_info_t rk_camera_info;


	rk_camera_info->phy_type		= CamSys_Phy_Cif; //cif:CamSys_Phy_Cif mipi:CamSys_Phy_Mipi
	rk_camera_info->lane_num		= 2; //values:1,2,4
	rk_camera_info->bit_rate		= 328; //lane_num(1):720, lane_num(2):328, lane_num(4):408
	rk_camera_info->phy_index		= 0x1; //Rx/Tx:0x1 Rx:0x0
	rk_camera_info->mipi_img_data_sel = 0x2c; //cif:0x2c mipi:0x2b
	rk_camera_info->cif_num			= 0;
	rk_camera_info->fmt				= CamSys_Fmt_Raw_12b;
	rk_camera_info->cifio			= CamSys_SensorBit0_CifBit4;

	rk_camera_info->width			= 800;
	rk_camera_info->height			= 600;

    // 321:  000: raw picture
    //       001: ccir656
    //       010: ccir601
    //       011: bayer rgb
    //       100: data mode
	rk_camera_info->Mode			= CCIR601;
	rk_camera_info->YCSequence		= CbYCrY;		   
	rk_camera_info->Conv422 		= Y0Cb0Y1Cr1;
	rk_camera_info->BPat			= BGBGGRGR ;
	rk_camera_info->HPol			= HPOL_HIGH;
	rk_camera_info->VPol			= VPOL_LOW;
	rk_camera_info->Edge			= SAMPLEEDGE_POS;
	//rk_camera_info->SmiaMode		= ISI_SMIA_OFF;
	//rk_camera_info->MipiMode		= ISI_MIPI_OFF;
	//rk_camera_info->SensorOutputMode = ISI_SENSOR_OUTPUT_MODE_YUV;
	rk_camera_info->dev_id = CAMSYS_DEVID_SENSOR_1B; //back:CAMSYS_DEVID_SENSOR_1A front:CAMSYS_DEVID_SENSOR_1B

	strlcpy((char*)rk_camera_info->sensorname, "GC2155",sizeof(rk_camera_info->sensorname));
	strlcpy((char*)rk_camera_info->version, "0x1.0.0",sizeof(rk_camera_info->version));
	return 0;
}



